<!-- src/app/components/dashboard/dashboard.component.html -->
<div class="min-h-screen bg-gray-50">


  <!-- Loading State -->
  <div *ngIf="loading" class="text-center py-12">
    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
    <p class="mt-4 text-gray-600">Chargement des données...</p>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading">
    <!-- Stats Cards -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <!-- Total Maraudes -->
        <div class="bg-white rounded-lg shadow p-6 border-l-4 border-blue-500">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-gray-600">Total Maraudes</p>
              <p class="text-3xl font-bold text-gray-900 mt-2">{{ stats.totalMaraudes }}</p>
              <p class="text-xs text-gray-500 mt-1">
                <span class="text-green-600">{{ stats.activeMaraudes }} actives</span>
              </p>
            </div>
            <div class="bg-blue-100 rounded-full p-3">
              <svg class="h-8 w-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"></path>
              </svg>
            </div>
          </div>
        </div>

        <!-- Total Bénéficiaires -->
        <div class="bg-white rounded-lg shadow p-6 border-l-4 border-green-500">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-gray-600">Bénéficiaires Aidés</p>
              <p class="text-3xl font-bold text-gray-900 mt-2">{{ stats.totalBeneficiaries }}</p>
              <p class="text-xs text-gray-500 mt-1">
                Moy: {{ stats.avgBeneficiariesPerReport }}/maraude
              </p>
            </div>
            <div class="bg-green-100 rounded-full p-3">
              <svg class="h-8 w-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
              </svg>
            </div>
          </div>
        </div>

        <!-- Bénévoles Actifs -->
        <div class="bg-white rounded-lg shadow p-6 border-l-4 border-orange-500">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-gray-600">Bénévoles Actifs</p>
              <p class="text-3xl font-bold text-gray-900 mt-2">{{ stats.totalVolunteers }}</p>
              <p class="text-xs text-gray-500 mt-1">
                Sur toutes les maraudes
              </p>
            </div>
            <div class="bg-orange-100 rounded-full p-3">
              <svg class="h-8 w-8 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
              </svg>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
        <!-- Create Maraude -->
        <button
          (click)="navigateToAddMaraude()"
          class="bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg p-6 shadow-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105">
          <div class="flex items-center">
            <div class="bg-white bg-opacity-20 rounded-full p-3 mr-4">
              <svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
              </svg>
            </div>
            <div class="text-left">
              <h3 class="text-lg font-semibold">Créer une maraude</h3>
              <p class="text-sm text-blue-100 mt-1">Planifier une nouvelle action</p>
            </div>
          </div>
        </button>

        <!-- Create Report -->
        <button
          (click)="navigateToAddReport()"
          class="bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg p-6 shadow-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105">
          <div class="flex items-center">
            <div class="bg-white bg-opacity-20 rounded-full p-3 mr-4">
              <svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
            </div>
            <div class="text-left">
              <h3 class="text-lg font-semibold">Créer un compte-rendu</h3>
              <p class="text-sm text-green-100 mt-1">Documenter une maraude</p>
            </div>
          </div>
        </button>

        <button
          *ngIf="currentUser?.role === 'admin'"
          (click)="navigateToAssociations()"
          class="bg-gradient-to-r from-indigo-500 to-indigo-600 text-white rounded-lg p-6 shadow-lg hover:from-indigo-600 hover:to-indigo-700 transition-all transform hover:scale-105">
          <div class="flex items-center">
            <div class="bg-white bg-opacity-20 rounded-full p-3 mr-4">
              <svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
              </svg>
            </div>
            <div class="text-left">
              <h3 class="text-lg font-semibold">Gérer les associations</h3>
              <p class="text-sm text-indigo-100 mt-1">Administrer les organisations</p>
            </div>
          </div>
        </button>


      </div>

      <!-- Two Column Layout -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- My Maraudes Section -->
        <div class="bg-white rounded-lg shadow">
          <div class="border-b border-gray-200 px-6 py-4">
            <div class="flex justify-between items-center">
              <h3 class="text-lg font-semibold text-gray-900">
                {{ isAdmin ? 'Toutes les maraudes' : 'Mes maraudes' }}
                <span *ngIf="isAdmin" class="ml-2 text-sm text-indigo-600 font-normal">(toutes associations)</span>
              </h3>
              <span class="text-sm text-gray-500">
                {{ stats.totalMaraudes }} maraude{{ stats.totalMaraudes > 1 ? 's' : '' }} au total
              </span>
            </div>
          </div>

          <div class="p-6">
            <div *ngIf="myMaraudes.length === 0" class="text-center py-8 text-gray-500">
              <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
              </svg>
              <p>Aucune maraude planifiée</p>
              <button
                (click)="navigateToAddMaraude()"
                class="mt-4 text-blue-600 hover:text-blue-500 font-medium">
                Créer votre première maraude
              </button>
            </div>

            <div class="space-y-4">
              <div *ngFor="let maraude of myMaraudes.slice(0, 5)"
                   class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors"
                   (click)="navigateToEditMaraude(maraude.id)">
                <div class="flex justify-between items-start">
                  <div class="flex-1">
                    <div class="flex items-center gap-2 flex-wrap">
                      <h4 class="font-medium text-gray-900">{{ maraude.title }}</h4>
                      <!-- Association Badge for Admin -->
                      <span *ngIf="isAdmin && maraude.association"
                            class="px-2 py-0.5 bg-indigo-100 text-indigo-800 text-xs rounded-full font-medium">
                        {{ maraude.association.name }}
                      </span>
                    </div>
                    <p class="text-sm text-gray-600 mt-1">{{ maraude.startAddress }}</p>
                    <div class="flex items-center mt-2 space-x-4 text-sm text-gray-500 flex-wrap gap-2">
                      <span *ngIf="maraude.isRecurring">
                        🔄 Tous les {{ maraude.dayName }}s à {{ maraude.startTime }}
                      </span>
                      <span *ngIf="!maraude.isRecurring && maraude.scheduledDate">
                        📅 {{ maraude.scheduledDate | date:'dd/MM/yyyy' }} à {{ maraude.startTime }}
                      </span>
                      <span>👥 {{ maraude.participantsCount }} bénévoles</span>
                      <span *ngIf="maraude.beneficiariesHelped > 0">
                        ❤️ {{ maraude.beneficiariesHelped }} personnes aidées
                      </span>
                    </div>
                  </div>
                  <div class="flex flex-col items-end ml-4">
                    <span class="px-2 py-1 text-xs font-medium rounded-full whitespace-nowrap" [ngClass]="getStatusClass(maraude.status)">
                      {{ getStatusText(maraude.status) }}
                    </span>
                    <span *ngIf="maraude.isHappeningToday" class="mt-1 px-2 py-1 bg-orange-100 text-orange-800 rounded-full text-xs font-medium animate-pulse">
                      Aujourd'hui
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <div *ngIf="myMaraudes.length > 5" class="text-center pt-4 border-t border-gray-200 mt-4">
              <button
                (click)="navigateToAllMaraudes()"
                class="text-blue-600 hover:text-blue-500 text-sm font-medium">
                Voir toutes les maraudes ({{ myMaraudes.length }})
              </button>
            </div>
          </div>
        </div>

        <!-- Recent Reports Section -->
        <div class="bg-white rounded-lg shadow">
          <div class="border-b border-gray-200 px-6 py-4">
            <div class="flex justify-between items-center">
              <h3 class="text-lg font-semibold text-gray-900">
                Derniers comptes-rendus
                <span *ngIf="isAdmin" class="ml-2 text-sm text-indigo-600 font-normal">(toutes associations)</span>
              </h3>
              <button
                (click)="navigateToReports()"
                class="text-sm text-blue-600 hover:text-blue-500 font-medium">
                Voir tout
              </button>
            </div>
          </div>

          <div class="p-6">
            <div *ngIf="recentReports.length === 0" class="text-center py-8 text-gray-500">
              <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
              <p>Aucun compte-rendu</p>
              <button
                (click)="navigateToAddReport()"
                class="mt-4 text-blue-600 hover:text-blue-500 font-medium">
                Créer un compte-rendu
              </button>
            </div>

            <div class="space-y-4">
              <div *ngFor="let report of recentReports.slice(0, 5)"
                   class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors"
                   (click)="navigateToViewReport(report.id)">
                <div class="flex justify-between items-start">
                  <div class="flex-1">
                    <div class="flex items-center gap-2 flex-wrap">
                      <h4 class="font-medium text-gray-900">
                        {{ report.maraudeAction?.title || 'Maraude sans titre' }}
                      </h4>
                      <!-- Association Badge for Admin -->
                      <span *ngIf="isAdmin && report.association"
                            class="px-2 py-0.5 bg-indigo-100 text-indigo-800 text-xs rounded-full font-medium">
                        {{ report.association.name }}
                      </span>
                    </div>
                    <p class="text-sm text-gray-600 mt-1">
                      Par {{ report.createdBy?.firstName }} {{ report.createdBy?.lastName }}
                    </p>
                    <div class="flex items-center mt-2 space-x-4 text-sm text-gray-500">
                      <span>📅 {{ formatDate(report.maraudeDate) }}</span>
                      <span>👥 {{ report.volunteersCount }} bénévoles</span>
                      <span>❤️ {{ report.beneficiariesCount }} bénéficiaires</span>
                    </div>
                  </div>
                  <div class="flex flex-col items-end ml-4">
                    <span class="px-2 py-1 text-xs font-medium rounded-full whitespace-nowrap" [ngClass]="getReportStatusClass(report.status)">
                      {{ getReportStatusText(report.status) }}
                    </span>
                    <span *ngIf="report.hasAlerts" class="mt-1 px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs font-medium">
                      🚨 Alertes
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <div *ngIf="recentReports.length > 5" class="text-center pt-4 border-t border-gray-200 mt-4">
              <button
                (click)="navigateToReports()"
                class="text-blue-600 hover:text-blue-500 text-sm font-medium">
                Voir tous les rapports ({{ recentReports.length }})
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Tips -->
      <div class="mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6">
        <h3 class="text-lg font-semibold text-blue-900 mb-3">💡 Conseils rapides</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-blue-800">
          <div class="flex items-start">
            <svg class="h-5 w-5 text-blue-600 mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div>
              <strong>Statistiques précises :</strong> Les chiffres sont calculés à partir de vos rapports validés
            </div>
          </div>
          <div class="flex items-start">
            <svg class="h-5 w-5 text-blue-600 mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div>
              <strong>Comptes-rendus :</strong> Créez des rapports détaillés après chaque maraude avec distributions et alertes
            </div>
          </div>
          <div class="flex items-start">
            <svg class="h-5 w-5 text-blue-600 mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
            </svg>
            <div>
              <strong>Localisation :</strong> Précisez l'adresse pour aider les bénévoles à vous rejoindre
            </div>
          </div>
          <div class="flex items-start">
            <svg class="h-5 w-5 text-blue-600 mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
            </svg>
            <div>
              <strong>Workflow rapports :</strong> Brouillon → Soumission → Validation par un coordinateur
            </div>
          </div>
        </div>
      </div>

      <!-- Admin-specific tip -->
      <div *ngIf="isAdmin" class="mt-4 bg-indigo-50 border border-indigo-200 rounded-lg p-6">
        <div class="flex items-start">
          <svg class="h-6 w-6 text-indigo-600 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
          </svg>
          <div>
            <h4 class="text-sm font-semibold text-indigo-900 mb-1">🔑 Mode Administrateur</h4>
            <p class="text-sm text-indigo-800">
              Vous voyez toutes les maraudes et tous les rapports de toutes les associations.
              Vous pouvez créer des maraudes pour n'importe quelle association et gérer les associations depuis le bouton en haut à droite.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
